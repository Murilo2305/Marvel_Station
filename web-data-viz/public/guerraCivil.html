<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Marvel Station</title>

  <script src="./js/sessao.js"></script>

  <link rel="stylesheet" href="./css/MarvelStation.css">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>

  <header>

    <nav>

      <div class="part1">

        <div>

          <img class="logo" src="./../public/assets/MarvelStation_Logo.png">

        </div>

        <ul>

          <li>

            <a href="index.html">Pagina Principal</a>

          </li>

          <li>

            <a href="sobreMim.html">Sobre o criador</a>

          </li>

          <li>

            <a class="active" href="guerraCivil.html">Discussões</a>

          </li>

        </ul>

      </div>

      <div class="part2">

        <img src="../public/assets/user_icon.png" alt=>

        <b id="b_usuario"></b>

        <button id="button_login"></button>


      </div>

    </nav>

  </header>

  <main>

    <div class="container-discucoes">

      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>
      <span>aaaaaaaaaaaaaaaaaaaaaaa</span><br>

      <input type="number" id="input_voto"><br>
      <button onclick="Votar()">Votar</button>

      <canvas id="canvas_resultadoVotacao"></canvas>

    </div>

    <div class="lista-discucoes">

      <h3>Todas as Discussões</h3>

      <ul>

        <li><a href="guerraCivil.html">Quem estava certo na guerra civil?</a></li>

      </ul>

    </div>

  </main>

  <footer>

    <span>Email de contato: marvel.station@gmail.com</span>

  </footer>

</body>

</html>

<script>

  var b_usuario = document.getElementById("b_usuario");
  var button_login = document.getElementById('button_login');

  if (sessionStorage.NOME_USUARIO != undefined && sessionStorage.NOME_USUARIO != 'undefined') {

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    button_login.innerHTML = 'Sair';
    button_login.onclick = Sair;


  } else {

    b_usuario.innerHTML = 'Visitante';
    button_login.innerHTML = 'Loginnnn';
    button_login.onclick = Login;

  }

  function Sair() {

    sessionStorage.clear();
    window.location.reload();


  }

  function Login() {

    window.location.href = 'login.html';

  }

  function Votar() {


    fetch('/votacao/votar', {

      method: 'POST',
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({

        voto: input_voto.value,
        idUsuario: sessionStorage.ID_USUARIO,
        idDiscucao: 1,

      }),

    })
      .then(function (resposta) {

        if (resposta.ok) {

          alert('Voto efetuado com sucesso!');

        } else {

          alert('Erro na votação');

        }

      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);

      });

    return false;

  }

  function gerarGrafico() {

    fetch(('votacao/gerarGrafico'), {

      method: 'POST',
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({

        idDiscucao: 1

      }),

    })
      .then(function (resposta) {

        resposta.json().then(function (response) {

          response.reverse();
          console.log(`Dados recebidos: ${JSON.stringify(response)}`);

          let labels = [

          'Votos'

          ];

          let dados = {

            labels: labels,
            datasets: [{
              label: 'Capitão América',
              data: [],
              fill: false,
              borderColor: 'rgb(75, 192, 192)',
              tension: 0.1
            },
            {
              label: 'Homem de Ferro',
              data: [],
              fill: false,
              borderColor: 'rgb(199, 52, 52)',
              tension: 0.1
            }]

          }


          dados.datasets[0].data.push(response[0].total);
          dados.datasets[1].data.push(response[1].total);



          const config = {
            type: 'bar',
            data: dados,
          };

          console.log('fazbear');

          let chartVotacao = new Chart(
            document.getElementById(`canvas_resultadoVotacao`),
            config
          );

        })



      })

  }

  gerarGrafico();

</script>