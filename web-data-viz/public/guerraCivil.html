<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Marvel Station</title>

  <script src="./js/sessao.js"></script>

  <link rel="stylesheet" href="./css/MarvelStation.css">
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="./css/MarvelStation.css">

</head>

<body>

  <header>

    <nav>

      <div class="part1">

        <div>

          <img class="logo" src="./assets/MarvelStation_Logo.png">

        </div>

        <ul>

          <li>

            <a href="index.html">Pagina Principal</a>

          </li>

          <li>

            <a href="sobreMim.html">Sobre o criador</a>

          </li>

          <li>

            <a class="active" href="guerraCivil.html">Discussões</a>

          </li>

        </ul>

      </div>

      <div class="part2">

        <img src="./assets/user_icon.png" alt=>

        <b id="b_usuario"></b>

        <button id="button_login"></button>


      </div>

    </nav>

  </header>

  <main>

    <div class="container-discucoes">

      <div class="titulo-esquerda">

        <h1>Quem estava certo na Guerra Civil?</h1>

      </div>

      <div class="bloco-texto">

        <span>Essa é uma discussão muito comum, porém muito interessante dentro dos círculos nerdísticos, principalmente
          porque o lançamento do filme em 2016 popularizou ainda mais o tópico, afinal, filmes têm um alcance muito
          maior
          que quadrinhos.</span>

        <span>Por mais que as duas versões tenham um conceito-base similar, o quadrinho possui mais nuances, na minha
          opinião,
          e portanto será o foco da discussão neste artigo.</span>


      </div>

      <div class="titulo-esquerda">

        <h2>O início</h2>

      </div>

      <div class="bloco-texto">

        <span>Todo o conflito se inicia em Civil War #1, de junho de 2006. A edição começa
          mostrando o evento que dará início a toda a trama: o desastre de Stamford.</span>

        <span>Tudo começa quando um grupo de super-heróis jovens e sem treinamento decide tentar prender
          um grupo de vilões que havia escapado da prisão para participar de um programa de televisão.</span>

        <span>Porém, por sua falta de experiência, os jovens heróis não conseguem manter o controle da situação,
          o que faz a batalha escalar rapidamente e sair da casa onde os vilões estavam escondidos, chegando
          ao pátio de uma escola, onde um dos malfeitores usa seus poderes para causar uma explosão gigantesca
          que mata todos no local.</span>


      </div>

      <div class="center">


        <img class="img-page" src="./assets/Stanphord.jpg" alt="">

      </div>

      <div class="bloco-texto">

        <span>Assim como na adaptação cinematográfica, esse evento faz o governo iniciar uma iniciativa de
          registro de super-heróis, buscando evitar que super-humanos ajam de forma inconsequente e causem
          desastres como o de Stamford.</span>

        <span>Essa iniciativa divide toda a comunidade super-humana, com os dois principais representantes de cada
          lado sendo o Homem de Ferro, que está de acordo com o registro, e o Capitão América, que é contra ele.
          O Capitão tem como principal argumento o fato de que a centralização das informações
          dos super-heróis abre espaço para que todos eles sejam derrubados de uma vez: se um vilão tiver acesso a essas
          informações, todos os heróis estariam vulneráveis.</span>

        <span>Já o Homem de Ferro acredita que, dessa forma, seria possível tornar as ações dos super-heróis mais
          organizadas e efetivas, aumentando a segurança da população e diminuindo tanto as casualidades civis
          quanto as super-humanas.</span>


      </div>

      <div class="bloco-texto">

        <span>Essa separação da comunidade resulta, como o próprio título implica, em uma guerra civil entre
          os super-heróis, com o lado do Homem de Ferro sendo apoiado pelo governo e o do Capitão América
          passando a ser considerado fora da lei.</span>

        <span>O conflito escala cada vez mais, culminando em uma batalha final entre ambos os lados no centro da
          cidade de Nova York.</span>


      </div>

      <div class="center">

        <img class="img-center" src="./assets/CWclimax.png" alt="">

      </div>

      <div class="bloco-texto">

        <span>Ao fim dela, o Capitão América decide se render, não por ter mudado de ideia sobre o registro
          dos super-heróis, mas por perceber o quão grandes estavam sendo os impactos do conflito
          para os cidadãos comuns. Para ele, não fazia sentido lutar uma luta que prejudicasse aqueles
          que ele jurou proteger.</span>

        <span>Com isso, Tony Stark se tornou o novo diretor da S.H.I.E.L.D. e foi responsável por registrar
          os heróis e prender aqueles que ficaram do lado do Capitão durante a Guerra Civil. De fato, ele foi
          capaz de aumentar a eficiência no combate ao crime e reduzir as fatalidades. Porém, acho importante
          que olhemos para as consequências desses eventos a longo prazo.</span>


      </div>

      <div class="titulo-esquerda">

        <h2>As consequências</h2>

      </div>

      <div class="bloco-texto">

        <span>Alguns anos após a Guerra Civil, aconteceu exatamente o que o Capitão temia:
          vilões se infiltraram na S.H.I.E.L.D. e tiveram acesso às informações dos super-heróis.</span>

        <span>Durante os eventos da Invasão Secreta, quando os Skrulls infiltrados na Terra tentaram tomar o poder
          do planeta, Tony Stark não foi capaz de lidar bem com a situação, e o conflito escalou muito
          rapidamente.</span>

        <span>Os Skrulls quase matam o presidente dos Estados Unidos, porém Norman Osborn, o Duende Verde,
          mata a rainha dos invasores, encerrando assim a ameaça Skrull.</span>


      </div>

      <div class="center">

        <img class="img-page" src="./assets/Norman.jpg" alt="">

      </div>

      <div class="bloco-texto">

        <span>Com isso, Tony Stark perde sua posição como líder da S.H.I.E.L.D. e passa a ser um criminoso procurado
          por suas ações durante a invasão, enquanto a organização é reformulada por Norman Osborn, tornando-se
          a H.A.M.M.E.R.</span>

        <span>Norman Osborn começa a sistematicamente eliminar super-heróis (tarefa extremamente fácil com acesso
          às informações coletadas por Tony Stark), substituindo-os por vilões sob seu comando e efetivamente
          criando um governo secreto com ele como líder.</span>

        <span>Eventualmente, eles são derrubados, mas aquilo que o Capitão dizia que aconteceria realmente
          ocorreu.</span>


      </div>

      <div class="titulo-esquerda">

        <h2>Conclusão</h2>

      </div>

      <div class="bloco-texto">

        <span>Admito que posso ser um tanto tendencioso para o lado do Capitão <span class="discreto">(quem leu
            a aba Sobre Mim deve entender o porquê)</span>, porém acredito que ambos os lados tinham bons pontos.
          Quem você acha que estava certo: o Capitão América ou o Homem de Ferro? Deixe seu voto e seu comentário
          me dizendo, e obrigado por ler até o final!</span>


      </div>

      <div class="center">

        <img class="img-center" src="./assets/capVSiron.png" alt="">

      </div>

      <!---->

      <div class="botoes">

        <button onclick="Votar(2)">Votar no Homem de Ferro</button>
        <button onclick="Votar(1)">Votar no Capitão América</button>

      </div>

      <div class="kpis">

        <div class="box-kpi">

          <span>Quantidade de votos</span><br>
          <h2 id="quant_votos">0</h2>

        </div>

        <div class="box-kpi">

          <span>Proporção de votos do Capitão América</span><br>
          <h2 id="prop1">0</h2>

        </div>

        <div class="box-kpi">

          <span>Proporção de votos do Homem de Ferro</span><br>
          <h2 id="prop2">0</h2>

        </div>

      </div>

      <canvas id="canvas_resultadoVotacao"></canvas><br>

      <span id="span_tamanho">0/1000</span><br>
      <textarea oninput="MostrarTamanho()" maxlength="1000" id="textarea_comentario"></textarea><br>
      <button onclick="Comentar()">Comentar</button>

      <div class="comentarios" id="div_comentarios">

        <div class="box-comentario">

          <div class="usuario">

            <img src="./assets/user_icon.png" alt="">
            <h1>usuario</h1>

          </div>

          <span></span>

        </div>

      </div>

    </div>

    <div class="lista-discucoes">

      <h3>Todas as Discussões</h3>

      <ul>

        <li><a href="guerraCivil.html">Quem estava certo na guerra civil?</a></li>

      </ul>

    </div>

  </main>

  <footer>

    <span>Email de contato: marvel.station@gmail.com</span>

  </footer>

</body>

</html>

<script>

  var chartVotacao;

  var b_usuario = document.getElementById("b_usuario");
  var button_login = document.getElementById('button_login');

  if (sessionStorage.NOME_USUARIO != undefined && sessionStorage.NOME_USUARIO != 'undefined') {

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO;
    button_login.innerHTML = 'Sair';
    button_login.onclick = Sair;


  } else {

    b_usuario.innerHTML = 'Visitante';
    button_login.innerHTML = 'Loginnnn';
    button_login.onclick = Login;

  }

  function Sair() {

    sessionStorage.clear();
    window.location.reload();


  }

  function Login() {

    window.location.href = 'login.html';

  }

  function MostrarTamanho() {

    var textarea = textarea_comentario.value;
    span_tamanho.innerHTML = `${textarea.length}/1000`;

  }

  function Comentar() {

    if (sessionStorage.NOME_USUARIO == undefined || sessionStorage.NOME_USUARIO == '') {

      alert('Você precisa estar logado para poder comentar');

    } else {


      fetch('/comentario/comentar', {

        method: 'POST',
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({

          texto: textarea_comentario.value,
          idUsuario: sessionStorage.ID_USUARIO,
          idDiscucao: 1,

        }),

      })
        .then(function (resposta) {

          if (resposta.ok) {

            alert('Comentário realizado com sucesso!')
            exibirComentarios();

          } else {

            alert('Erro ao comentar')

          }

        })
    }

  }

  function exibirComentarios() {

    fetch(('comentario/exibirComentarios'), {

      method: 'POST',
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({

        idDiscucao: 1

      }),

    })
      .then(function (resposta) {

        resposta.json().then(function (response) {

          response.reverse();
          console.log(JSON.stringify(response));

          var msg = '';

          for (var x = 0; x < response.length; x++) {

            msg += `
          
            <div class="box-comentario">

              <div class="usuario">

                <img src="./assets/user_icon.png" alt=""> 
                <h1>${response[x].nome}</h1>

              </div>

              <span>${response[x].texto}</span>

            </div>
            `

          }

          div_comentarios.innerHTML = msg;

        })

      })

  }

  function Votar(x) {


    fetch('/votacao/votar', {

      method: 'POST',
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({

        voto: x,
        idUsuario: sessionStorage.ID_USUARIO,
        idDiscucao: 1,

      }),

    })
      .then(function (resposta) {

        if (resposta.ok) {

          alert('Voto efetuado com sucesso!');
          AtualizarGrafico(chartVotacao.data);

        } else {

          alert('Erro na votação');

        }

      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);

      });

    return false;

  }

  function gerarGrafico() {

    fetch(('votacao/gerarGrafico'), {

      method: 'POST',
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({

        idDiscucao: 1

      }),

    })
      .then(function (resposta) {

        resposta.json().then(function (response) {

          console.log(`Dados recebidos: ${JSON.stringify(response)}`);

          console.log(response);

          let labels = [

            'Votos'

          ];

          let dados = {

            labels: labels,
            datasets: [{
              label: 'Capitão América',
              data: [],
              fill: false,
              borderColor: '#0000ff',
              backgroundColor: '#002d5c',
              tension: 0.1
            },
            {
              label: 'Homem de Ferro',
              data: [],
              fill: false,
              borderColor: '#E30022',
              backgroundColor: '#CC0000',
              tension: 0.1
            }]

          }

          var opt1;
          var opt2;

          if (response.length > 1) {

            dados.datasets[0].data.push(response[0].total);
            dados.datasets[1].data.push(response[1].total);

            var opt1 = response[0].total;
            var opt2 = response[1].total;

          } else if (response.length == 1 && response[0].Opcao == 1) {

            dados.datasets[0].data.push(response[0].total);
            dados.datasets[1].data.push(0);

            var opt1 = response[0].total;
            var opt2 = 0;

          } else if (response.length == 1 && response[0].Opcao == 2) {

            dados.datasets[0].data.push(0);
            dados.datasets[1].data.push(response[0].total);

            var opt1 = 0;
            var opt2 = response[0].total;

          } else {

            dados.datasets[0].data.push(0);
            dados.datasets[1].data.push(0);

            var opt1 = 0;
            var opt2 = 0;

          }



          const config = {
            type: 'bar',
            data: dados,
            options: {

              scales: {

                x: {

                  ticks: {

                    color: 'black'

                  }

                },
                y: {

                  ticks: {

                    color: 'black'

                  }

                }

              }

            }
          };

          chartVotacao = new Chart(
            document.getElementById(`canvas_resultadoVotacao`),
            config
          );

          quant_votos.innerHTML = opt1 + opt2;

          if ((Number(opt1) + Number(opt2)) > 0) {

            prop1.innerHTML = `${((opt1 / (opt1 + opt2)) * 100).toFixed(2)}%`;
            prop2.innerHTML = `${((opt2 / (opt1 + opt2)) * 100).toFixed(2)}%`;

          } else {

            prop1.innerHTML = `0%`;
            prop2.innerHTML = `0%`;

          }

        })



      })

  }

  function AtualizarGrafico(dados) {

    fetch(('votacao/gerarGrafico'), {

      method: 'POST',
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({

        idDiscucao: 1

      }),

    })
      .then(function (resposta) {

        resposta.json().then(function (response) {

          console.log(`Dados recebidos: ${JSON.stringify(response)}`);

          dados.datasets[0].data.shift();
          dados.datasets[1].data.shift();

          var opt1;
          var opt2;

          if (response.length > 1) {

            dados.datasets[0].data.push(response[0].total);
            dados.datasets[1].data.push(response[1].total);

            var opt1 = response[0].total;
            var opt2 = response[1].total;

          } else if (response.length == 1 && response[0].Opcao == 1) {

            dados.datasets[0].data.push(response[0].total);
            dados.datasets[1].data.push(0);

            var opt1 = response[0].total;
            var opt2 = 0;

          } else if (response.length == 1 && response[0].Opcao == 2) {

            dados.datasets[0].data.push(0);
            dados.datasets[1].data.push(response[0].total);

            var opt1 = 0;
            var opt2 = response[0].total;

          } else {

            dados.datasets[0].data.push(0);
            dados.datasets[1].data.push(0);

            var opt1 = 0;
            var opt2 = 0;

          }

          quant_votos.innerHTML = opt1 + opt2;

          if ((Number(opt1) + Number(opt2)) > 0) {

            prop1.innerHTML = `${((opt1 / (opt1 + opt2)) * 100).toFixed(2)}%`;
            prop2.innerHTML = `${((opt2 / (opt1 + opt2)) * 100).toFixed(2)}%`;

          } else {

            prop1.innerHTML = `0%`;
            prop2.innerHTML = `0%`;

          }

          chartVotacao.update();

        })

      })

  }

  gerarGrafico();
  exibirComentarios();

</script>